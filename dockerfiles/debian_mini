# Educational Linux Learning System - Beginner Friendly
# Designed for students with zero Linux command line experience
# Progressive 5-level system with protected validation scripts

FROM --platform=i386 i386/debian:buster

# Fix sources for older Debian version
RUN sed -i s/deb.debian.org/archive.debian.org/g /etc/apt/sources.list

ARG DEBIAN_FRONTEND=noninteractive

# Install essential packages
RUN apt-get update \
 && apt-get -y upgrade \
 && apt-get install -y apt-utils zip unzip vim less binutils curl wget \
    cowsay figlet toilet lolcat bc tree file \
 && rm -rf /var/lib/apt/lists/*

# Create users
RUN useradd -m user && echo "user:password" | chpasswd \
 && echo "root:password" | chpasswd

# Create protected script directories
RUN mkdir -p /usr/local/share/learning-scripts/{validators,helpers,content}

# Create user learning environment
RUN mkdir -p /home/user/{practice,completed} \
 && chown -R user:user /home/user

# Initialize progress tracking
RUN echo "current_level:1" > /home/user/.learning_progress \
 && echo "completed_levels:" >> /home/user/.learning_progress \
 && echo "total_score:0" >> /home/user/.learning_progress \
 && echo "skills_learned:" >> /home/user/.learning_progress \
 && chown user:user /home/user/.learning_progress

# =============================================================================
# LEVEL 1: First Steps - "Hello Terminal"
# Goal: Get comfortable typing commands and seeing output
# Commands: echo, whoami, pwd
# =============================================================================

RUN mkdir -p /home/user/level1

# Create Level 1 welcome and instructions
RUN printf "🎓 WELCOME TO LINUX LEARNING LAB! 🎓\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n👋 Hello! This is your first time using a Linux terminal!\n   Don't worry - we'll start VERY simple.\n\n🎯 LEVEL 1 GOAL: Learn to make the computer talk to you!\n\n📝 YOUR FIRST CHALLENGES:\n\n1️⃣  Make the computer say hello:\n    Type: echo \"Hello World\"\n\n2️⃣  Ask the computer who you are:\n    Type: whoami\n\n3️⃣  Ask where you are:\n    Type: pwd\n\n4️⃣  Say something about yourself:\n    Type: echo \"My name is [put your name here]\"\n\n5️⃣  Try a fun command:\n    Type: echo \"I am learning Linux!\"\n\n💡 HELP COMMANDS:\n   help  - Show helpful reminders\n   hint  - Get a gentle hint\n   check - Check your progress\n\n🚀 When you've tried all the commands above, type: check\n" > /home/user/level1/welcome.txt

# Ensure directories exist before creating scripts
RUN mkdir -p /usr/local/share/learning-scripts/validators /usr/local/share/learning-scripts/helpers /usr/local/share/learning-scripts/content

# Create simplified Level 1 validator script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'echo "LEVEL 1 PROGRESS CHECK"' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'score=0' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'if history | grep -q echo; then echo "Used echo (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'if history | grep -q whoami; then echo "Used whoami (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'if history | grep -q pwd; then echo "Used pwd (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'echo "Score: $score/3"' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'if [ $score -ge 2 ]; then' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  echo "LEVEL 1 COMPLETED!"' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  echo "Next: cd ../level2 && cat welcome.txt"' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  sed -i "s/current_level:1/current_level:2/" /home/user/.learning_progress' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  mkdir -p /home/user/level2' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  cp /usr/local/share/learning-scripts/content/level2/* /home/user/level2/ 2>/dev/null || true' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'else' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo '  echo "Keep practicing! Try: echo, whoami, pwd"' >> /usr/local/share/learning-scripts/validators/check_level1.sh
RUN echo 'fi' >> /usr/local/share/learning-scripts/validators/check_level1.sh

RUN chmod +x /usr/local/share/learning-scripts/validators/check_level1.sh

# =============================================================================
# LEVEL 2: Looking Around - "What's Here?"
# Goal: Learn to see what's in folders
# Commands: ls, ls -l, ls -la
# =============================================================================

RUN mkdir -p /usr/local/share/learning-scripts/content/level2/practice-files

# Create Level 2 content
RUN printf "📂 LEVEL 2: EXPLORING FILES AND FOLDERS\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎯 GOAL: Learn to see what files and folders are around you!\n\nIn the real world, you need to look around to see what'"'"'s there.\nIn Linux, we use special commands to \"look around\" digitally!\n\n📝 YOUR CHALLENGES:\n\n1️⃣  See what files are in this folder:\n    Type: ls\n\n2️⃣  See MORE details about the files:\n    Type: ls -l\n    (This shows file sizes, dates, permissions)\n\n3️⃣  See HIDDEN files too:\n    Type: ls -la\n    (Files starting with . are usually hidden)\n\n4️⃣  Look inside the practice-files folder:\n    Type: ls practice-files\n\n5️⃣  See details of practice-files contents:\n    Type: ls -l practice-files\n\n🎯 TREASURE HUNT: Find all 5 files in practice-files!\n   Then type '"'"'check'"'"' to see if you found them all!\n\n💡 Remember: help, hint, and check are always available!\n" > /usr/local/share/learning-scripts/content/level2/welcome.txt

# Create practice files
RUN echo "Congratulations! You found the first practice file!" > /usr/local/share/learning-scripts/content/level2/practice-files/readme.txt
RUN echo "This file contains important information about Linux!" > /usr/local/share/learning-scripts/content/level2/practice-files/important.txt
RUN echo "You are doing great with your Linux learning!" > /usr/local/share/learning-scripts/content/level2/practice-files/encouragement.txt
RUN echo "Secret treasure: You found a hidden message!" > /usr/local/share/learning-scripts/content/level2/practice-files/.secret.txt
RUN echo "Final file: You are becoming a Linux explorer!" > /usr/local/share/learning-scripts/content/level2/practice-files/final.txt

# Create simplified Level 2 validator script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'echo "LEVEL 2 PROGRESS CHECK"' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'score=0' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'if history | grep -q "ls"; then echo "Used ls (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'if history | grep -q "ls -l"; then echo "Used ls -l (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'echo "Score: $score/2"' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'if [ $score -ge 1 ]; then' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  echo "LEVEL 2 COMPLETED!"' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  echo "Next: cd ../level3 && cat welcome.txt"' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  sed -i "s/current_level:2/current_level:3/" /home/user/.learning_progress' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  mkdir -p /home/user/level3' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  cp /usr/local/share/learning-scripts/content/level3/* /home/user/level3/ 2>/dev/null || true' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'else' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo '  echo "Keep practicing! Try: ls and ls -l"' >> /usr/local/share/learning-scripts/validators/check_level2.sh
RUN echo 'fi' >> /usr/local/share/learning-scripts/validators/check_level2.sh

RUN chmod +x /usr/local/share/learning-scripts/validators/check_level2.sh

# =============================================================================
# LEVEL 3: Reading Files - "Digital Books"
# Goal: Learn to read file contents
# Commands: cat, less, head, tail
# =============================================================================

RUN mkdir -p /usr/local/share/learning-scripts/content/level3

# Create Level 3 content
RUN printf "📖 LEVEL 3: READING FILES (Digital Books!)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎯 GOAL: Learn to read what'"'"'s inside files!\n\nFiles are like digital books - you need to open them to read!\nIn Linux, we don'"'"'t double-click. We use special commands!\n\n📝 YOUR CHALLENGES:\n\n1️⃣  Read a short file:\n    Type: cat story.txt\n\n2️⃣  Read the instructions file:\n    Type: cat instructions.txt\n\n3️⃣  Look at just the beginning of a long file:\n    Type: head long_story.txt\n\n4️⃣  Look at just the end of a long file:\n    Type: tail long_story.txt\n\n5️⃣  Read a long file page by page:\n    Type: less long_story.txt\n    (Use SPACEBAR to go forward, '"'"'q'"'"' to quit)\n\n🎯 SECRET MISSION: Find the magic word hidden in one of the files!\n   Read all the files and look for the secret word!\n\n💡 TIP: cat is for short files, less is for long files!\n" > /usr/local/share/learning-scripts/content/level3/welcome.txt

# Create readable files for Level 3
RUN printf "Once upon a time, there was a student learning Linux.\nThey discovered that reading files was easy and fun!\nThe magic word they learned was: EXPLORER\nAnd they lived happily ever after, exploring the digital world!\n" > /usr/local/share/learning-scripts/content/level3/story.txt

RUN printf "INSTRUCTIONS FOR LEVEL 3:\n\n1. Use '"'"'cat'"'"' to read short files\n2. Use '"'"'less'"'"' to read long files (press '"'"'q'"'"' to quit)\n3. Use '"'"'head'"'"' to see the beginning of files\n4. Use '"'"'tail'"'"' to see the end of files\n\nRemember: The secret word is hidden in one of these files!\nRead them all to find it!\n" > /usr/local/share/learning-scripts/content/level3/instructions.txt

RUN printf "This is a longer story that demonstrates the '"'"'less'"'"' command.\n\nChapter 1: The Beginning\nOnce there was a curious student who wanted to learn Linux.\nThey started with simple commands and built their confidence.\n\nChapter 2: The Journey\nDay by day, they learned new commands.\nFirst echo, then ls, and now reading files!\nEach command was like discovering a new superpower.\n\nChapter 3: The Discovery\nThe student realized that Linux was not scary at all.\nIt was just a different way of talking to computers.\nAnd computers, it turns out, are quite friendly!\n\nChapter 4: The Secret\nIn this story, there is a hidden secret word: READER\nThis word represents someone who can read files in Linux!\n\nChapter 5: The Future\nWith each new skill, the student grew more confident.\nSoon they would be ready for even more advanced commands.\nThe journey of learning never ends!\n\nThe End.\n\nP.S. - You are doing amazing! Keep going!\n" > /usr/local/share/learning-scripts/content/level3/long_story.txt

# Create simplified Level 3 validator script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'echo "LEVEL 3 PROGRESS CHECK"' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'score=0' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'if history | grep -q "cat"; then echo "Used cat (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'if history | grep -q "less\\|head\\|tail"; then echo "Used file reader (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'echo "Score: $score/2"' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'if [ $score -ge 1 ]; then' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  echo "LEVEL 3 COMPLETED!"' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  echo "Next: cd ../level4 && cat welcome.txt"' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  sed -i "s/current_level:3/current_level:4/" /home/user/.learning_progress' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  mkdir -p /home/user/level4' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  cp /usr/local/share/learning-scripts/content/level4/* /home/user/level4/ 2>/dev/null || true' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'else' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo '  echo "Keep reading! Try: cat story.txt"' >> /usr/local/share/learning-scripts/validators/check_level3.sh
RUN echo 'fi' >> /usr/local/share/learning-scripts/validators/check_level3.sh

RUN chmod +x /usr/local/share/learning-scripts/validators/check_level3.sh

# =============================================================================
# LEVEL 4: Moving Around - "Digital Navigation"
# Goal: Navigate between folders
# Commands: cd, cd .., pwd (reinforcement)
# =============================================================================

RUN mkdir -p /usr/local/share/learning-scripts/content/level4/{treasure,secret,practice}

# Create Level 4 content and navigation structure
RUN printf "🧭 LEVEL 4: MOVING AROUND (Digital Navigation!)\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎯 GOAL: Learn to move between folders like a digital explorer!\n\nJust like in real life, you need to move around to explore.\nIn Linux, folders are like rooms in a house!\n\n📁 FOLDER STRUCTURE:\nlevel4/\n├── treasure/     (contains gold!)\n├── secret/       (contains mysteries!)\n└── practice/     (for practicing!)\n\n📝 YOUR CHALLENGES:\n\n1️⃣  See where you are right now:\n    Type: pwd\n\n2️⃣  Go into the treasure folder:\n    Type: cd treasure\n\n3️⃣  See what'"'"'s in the treasure folder:\n    Type: ls\n\n4️⃣  Go back to the main level4 folder:\n    Type: cd ..\n    (.. means \"go up one folder\")\n\n5️⃣  Check where you are:\n    Type: pwd\n\n6️⃣  Go into the secret folder:\n    Type: cd secret\n\n7️⃣  Explore what'"'"'s there:\n    Type: ls\n\n8️⃣  Go back to main folder:\n    Type: cd ..\n\n🎯 TREASURE HUNT: Find the golden key in one of the folders!\n\n💡 TIPS:\n   • pwd = shows where you are\n   • cd [folder] = go into folder\n   • cd .. = go back up\n   • ls = see what'"'"'s here\n" > /usr/local/share/learning-scripts/content/level4/welcome.txt

# Create treasure hunt files
RUN echo "🏆 CONGRATULATIONS! You found the golden treasure!" > /usr/local/share/learning-scripts/content/level4/treasure/gold.txt
RUN echo "💰 Golden Key: NAVIGATOR" > /usr/local/share/learning-scripts/content/level4/treasure/golden_key.txt
RUN echo "🎁 Extra treasure for brave explorers!" > /usr/local/share/learning-scripts/content/level4/treasure/bonus.txt

RUN echo "🤫 This is a secret message: Well done, explorer!" > /usr/local/share/learning-scripts/content/level4/secret/message.txt
RUN echo "🔐 Secret code: PATHFINDER" > /usr/local/share/learning-scripts/content/level4/secret/code.txt

RUN echo "This is a practice file for navigation!" > /usr/local/share/learning-scripts/content/level4/practice/test.txt

# Create simplified Level 4 validator script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'echo "LEVEL 4 PROGRESS CHECK"' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'score=0' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'if history | grep -q "cd"; then echo "Used cd (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'if history | grep -q "pwd"; then echo "Used pwd (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'echo "Score: $score/2"' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'if [ $score -ge 1 ]; then' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  echo "LEVEL 4 COMPLETED!"' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  echo "Next: cd ../level5 && cat welcome.txt"' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  sed -i "s/current_level:4/current_level:5/" /home/user/.learning_progress' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  mkdir -p /home/user/level5' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  cp /usr/local/share/learning-scripts/content/level5/* /home/user/level5/ 2>/dev/null || true' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'else' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo '  echo "Keep practicing! Try: cd treasure"' >> /usr/local/share/learning-scripts/validators/check_level4.sh
RUN echo 'fi' >> /usr/local/share/learning-scripts/validators/check_level4.sh

RUN chmod +x /usr/local/share/learning-scripts/validators/check_level4.sh

# =============================================================================
# LEVEL 5: Creating Things - "Digital Creator"
# Goal: Make first files and folders
# Commands: touch, echo >, mkdir
# =============================================================================

RUN mkdir -p /usr/local/share/learning-scripts/content/level5

# Create Level 5 content
RUN printf "✨ LEVEL 5: CREATING FILES AND FOLDERS\n━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\n\n🎯 GOAL: Learn to create your own files and folders!\n\nNow you'"'"'re ready to make your own digital creations!\nJust like an artist with a blank canvas!\n\n📝 YOUR CHALLENGES:\n\n1️⃣  Create your first empty file:\n    Type: touch my_first_file.txt\n    Then check it exists: ls\n\n2️⃣  Write something in a file:\n    Type: echo \"Hello, I am learning Linux!\" > my_message.txt\n    Then read it: cat my_message.txt\n\n3️⃣  Create a file with your name:\n    Type: echo \"My name is [YOUR NAME]\" > about_me.txt\n\n4️⃣  Create your first folder:\n    Type: mkdir my_projects\n    Then check it exists: ls\n\n5️⃣  Create another folder:\n    Type: mkdir completed_work\n\n6️⃣  Write a file about your favorite color:\n    Type: echo \"My favorite color is [COLOR]\" > favorite_color.txt\n\n7️⃣  Create a folder inside my_projects:\n    Type: mkdir my_projects/level5_work\n\n🎯 CREATIVE CHALLENGE: Create 3 files and 2 folders!\n   Make them about yourself - be creative!\n\n💡 REMEMBER:\n   • touch = create empty file\n   • echo \"text\" > file.txt = create file with text\n   • mkdir = create folder\n" > /usr/local/share/learning-scripts/content/level5/welcome.txt

# Create simplified Level 5 validator script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'echo "LEVEL 5 PROGRESS CHECK"' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'score=0' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'if history | grep -q "touch"; then echo "Used touch (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'if history | grep -q "mkdir"; then echo "Used mkdir (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'if history | grep -q "echo.*>"; then echo "Used echo > (+1)"; ((score++)); fi' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'echo "Score: $score/3"' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'if [ $score -ge 2 ]; then' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo '  echo "LEVEL 5 COMPLETED!"' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo '  echo "CONGRATULATIONS! You completed all levels!"' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo '  sed -i "s/current_level:5/current_level:completed/" /home/user/.learning_progress' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'else' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo '  echo "Keep creating! Try: touch, mkdir, echo >"' >> /usr/local/share/learning-scripts/validators/check_level5.sh
RUN echo 'fi' >> /usr/local/share/learning-scripts/validators/check_level5.sh

RUN chmod +x /usr/local/share/learning-scripts/validators/check_level5.sh

# =============================================================================
# HELPER SCRIPTS - Available in all levels
# =============================================================================

# Create simplified help script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/helpers/help.sh
RUN echo 'current_level=$(grep "current_level" /home/user/.learning_progress | cut -d: -f2)' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo 'echo "LINUX LEARNING LAB - HELP"' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo 'echo "You are on LEVEL $current_level"' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo 'case $current_level in' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  1) echo "Commands: echo, whoami, pwd";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  2) echo "Commands: ls, ls -l, ls -la";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  3) echo "Commands: cat, less, head, tail";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  4) echo "Commands: cd, cd .., pwd";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  5) echo "Commands: touch, echo >, mkdir";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo '  *) echo "Available: help, hint, check, progress";;' >> /usr/local/share/learning-scripts/helpers/help.sh
RUN echo 'esac' >> /usr/local/share/learning-scripts/helpers/help.sh

# Create hint script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo 'current_level=$(grep "current_level" /home/user/.learning_progress | cut -d: -f2)' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo 'echo "💡 HINT SYSTEM"' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo 'echo ""' >> /usr/local/share/learning-scripts/helpers/hint.sh

RUN echo 'case $current_level in' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    1) echo "🚀 Start with: echo \"Hello World\"";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    2) echo "🔍 Try: ls then ls -la practice-files";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    3) echo "📖 Try: cat story.txt";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    4) echo "🧭 Try: cd treasure, then ls";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    5) echo "✨ Try: touch my_file.txt";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo '    *) echo "🤔 Try \"help\" for your current level!";;' >> /usr/local/share/learning-scripts/helpers/hint.sh && \
    echo 'esac' >> /usr/local/share/learning-scripts/helpers/hint.sh

# Create progress script
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'echo "📊 YOUR LEARNING PROGRESS"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'current_level=$(grep "current_level" /home/user/.learning_progress | cut -d: -f2)' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'completed_count=$(wc -l < /home/user/.completed_levels 2>/dev/null || echo 0)' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'echo "🎯 Current Level: $current_level/5"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'echo "✅ Completed: $completed_count"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'echo ""' >> /usr/local/share/learning-scripts/helpers/progress.sh

RUN echo 'for i in 1 2 3 4 5; do' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '    if [ $i -lt $current_level ] 2>/dev/null; then' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '        echo "   Level $i: ✅ COMPLETED"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '    elif [ $i -eq $current_level ] 2>/dev/null; then' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '        echo "   Level $i: 🔄 IN PROGRESS"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '    else' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '        echo "   Level $i: 🔒 LOCKED"' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo '    fi' >> /usr/local/share/learning-scripts/helpers/progress.sh && \
    echo 'done' >> /usr/local/share/learning-scripts/helpers/progress.sh

# Create universal check command
RUN echo '#!/bin/bash' > /usr/local/share/learning-scripts/helpers/check.sh && \
    echo 'current_level=$(grep "current_level" /home/user/.learning_progress | cut -d: -f2)' >> /usr/local/share/learning-scripts/helpers/check.sh && \
    echo 'if [ -f "/usr/local/share/learning-scripts/validators/check_level${current_level}.sh" ]; then' >> /usr/local/share/learning-scripts/helpers/check.sh && \
    echo '    /usr/local/share/learning-scripts/validators/check_level${current_level}.sh' >> /usr/local/share/learning-scripts/helpers/check.sh && \
    echo 'else' >> /usr/local/share/learning-scripts/helpers/check.sh && \
    echo '    echo "🎉 All levels completed! You are a Linux expert!"' >> /usr/local/share/learning-scripts/helpers/check.sh && \
    echo 'fi' >> /usr/local/share/learning-scripts/helpers/check.sh

# Create symbolic links for easy access
RUN ln -sf /usr/local/share/learning-scripts/helpers/help.sh /usr/local/bin/help \
 && ln -sf /usr/local/share/learning-scripts/helpers/hint.sh /usr/local/bin/hint \
 && ln -sf /usr/local/share/learning-scripts/helpers/progress.sh /usr/local/bin/progress \
 && ln -sf /usr/local/share/learning-scripts/helpers/check.sh /usr/local/bin/check

# =============================================================================
# INITIAL SETUP AND WELCOME
# =============================================================================

# Copy initial level content to user directory
RUN cp -r /usr/local/share/learning-scripts/content/level2 /home/user/ 2>/dev/null || true \
 && cp -r /usr/local/share/learning-scripts/content/level3 /home/user/ 2>/dev/null || true \
 && cp -r /usr/local/share/learning-scripts/content/level4 /home/user/ 2>/dev/null || true \
 && cp -r /usr/local/share/learning-scripts/content/level5 /home/user/ 2>/dev/null || true

# Set proper ownership
RUN chown -R user:user /home/user

# Create simplified welcome script
RUN echo '#!/bin/bash' > /home/user/welcome.sh
RUN echo 'clear' >> /home/user/welcome.sh
RUN echo 'echo "LINUX LEARNING LAB"' >> /home/user/welcome.sh
RUN echo 'echo "Welcome to your Linux Learning Adventure!"' >> /home/user/welcome.sh
RUN echo 'echo ""' >> /home/user/welcome.sh
RUN echo 'echo "GETTING STARTED:"' >> /home/user/welcome.sh
RUN echo 'echo "  cd level1         - Go to first lesson"' >> /home/user/welcome.sh
RUN echo 'echo "  cat welcome.txt   - Read welcome"' >> /home/user/welcome.sh
RUN echo 'echo "  help             - Get help"' >> /home/user/welcome.sh
RUN echo 'echo "  hint             - Get hints"' >> /home/user/welcome.sh
RUN echo 'echo "  check            - Check progress"' >> /home/user/welcome.sh
RUN echo 'echo ""' >> /home/user/welcome.sh
RUN echo 'echo "MISSION: Complete 5 levels!"' >> /home/user/welcome.sh

RUN chmod +x /home/user/welcome.sh

# Add welcome to bashrc so it runs on every login
RUN echo '' >> /home/user/.bashrc \
 && echo '# Linux Learning Lab Welcome' >> /home/user/.bashrc \
 && echo '/home/user/welcome.sh' >> /home/user/.bashrc \
 && echo '' >> /home/user/.bashrc

# Set working directory and environment
WORKDIR /home/user
ENV HOME="/home/user" TERM="xterm" USER="user" SHELL="/bin/bash" EDITOR="vim" LANG="en_US.UTF-8" LC_ALL="C"

# Start bash in login mode
CMD ["/bin/bash", "-l"]
